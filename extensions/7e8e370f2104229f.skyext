const message = require('message');
const command = require('command');
const utils = require('utils');
const embed = require('embed');

const choices = ['rock', 'paper', 'scissors'];
const emojis = { rock: 'ğŸª¨', paper: 'ğŸ“„', scissors: 'âœ‚ï¸' };
const suffix = command.suffix.toLowerCase().trim();

// Parse user choice
let userChoice = null;
for (const c of choices) {
	if (suffix.startsWith(c)) {
		userChoice = c;
		break;
	}
}

if (!userChoice) {
	message.reply({
		embeds: [embed.create({
			title: 'âœ‚ï¸ Rock Paper Scissors',
			description: 'Usage: `' + command.prefix + command.key + ' <rock|paper|scissors>`\n\n' +
				'ğŸª¨ ' + utils.discord.bold('Rock') + ' beats Scissors\n' +
				'ğŸ“„ ' + utils.discord.bold('Paper') + ' beats Rock\n' +
				'âœ‚ï¸ ' + utils.discord.bold('Scissors') + ' beats Paper',
			color: embed.colors.PURPLE
		})]
	});
} else {
	// Bot makes choice
	const botChoice = utils.random.pick(choices);
	
	let result, color;
	if (userChoice === botChoice) {
		result = "It's a tie! ğŸ¤";
		color = embed.colors.GOLD;
	} else if (
		(userChoice === 'rock' && botChoice === 'scissors') ||
		(userChoice === 'paper' && botChoice === 'rock') ||
		(userChoice === 'scissors' && botChoice === 'paper')
	) {
		result = 'You win! ğŸ‰';
		color = embed.colors.SUCCESS;
	} else {
		result = 'You lose! ğŸ˜¢';
		color = embed.colors.ERROR;
	}
	
	message.reply({
		embeds: [embed.create({
			title: 'âœ‚ï¸ Rock Paper Scissors',
			description: 
				utils.discord.bold('You:') + ' ' + emojis[userChoice] + ' ' + utils.text.capitalize(userChoice) + '\n' +
				utils.discord.bold('Bot:') + ' ' + emojis[botChoice] + ' ' + utils.text.capitalize(botChoice) + '\n\n' +
				utils.discord.bold(result),
			color: color
		})]
	});
}