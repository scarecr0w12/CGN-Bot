<!DOCTYPE html>
<html lang="en">
<head>
	<title><%= pageData.pageTitle %> | Skynet Discord Bot Documentation</title>
	<%
	// SEO for wiki pages
	if (typeof pageData !== "undefined") {
		const isArticle = pageData.mode === "page" && pageData.content;
		pageData.seo = {
			title: `${pageData.pageTitle} | Skynet Discord Bot Documentation`,
			description: isArticle 
				? `Learn about ${pageData.title.replace(/-/g, ' ')} - Skynet Discord bot documentation and guides.`
				: "Skynet Discord bot documentation - comprehensive guides, command references, and tutorials for server setup and configuration.",
			keywords: `Discord bot documentation, ${pageData.title ? pageData.title.replace(/-/g, ' ') + ', ' : ''}Discord bot guide, Discord bot tutorial, Skynet wiki, Discord server setup`,
			type: isArticle ? "article" : "website"
		};
		pageData.breadcrumbs = [
			{ name: "Home", url: "/" },
			{ name: "Wiki", url: "/wiki" }
		];
		if (pageData.title && pageData.title !== "Wiki") {
			pageData.breadcrumbs.push({ name: pageData.title.replace(/-/g, ' '), url: `/wiki/${pageData.title}` });
		}
	}
	%>
	<%- include('../partials/head') %>
	
	<style>
	/* Wiki Page Styles */
	.wiki-sidebar {
		background: var(--color-bg-primary);
		border-radius: var(--radius-xl);
		padding: 1.5rem;
		box-shadow: var(--shadow-card);
		position: sticky;
		top: 1rem;
	}
	.wiki-search {
		margin-bottom: 1rem;
	}
	.wiki-search .input {
		border-radius: var(--radius-md) 0 0 var(--radius-md);
		border: 1px solid var(--color-border);
	}
	.wiki-search .input:focus {
		border-color: var(--color-primary);
	}
	.wiki-search .button {
		border-radius: 0 var(--radius-md) var(--radius-md) 0;
	}
	.wiki-sidebar .menu-label {
		color: var(--color-text-muted);
		font-size: 0.7rem;
		font-weight: 700;
		letter-spacing: 0.1em;
		text-transform: uppercase;
		margin-top: 1.25rem;
		margin-bottom: 0.5rem;
	}
	.wiki-sidebar .menu-label:first-child {
		margin-top: 0;
	}
	.wiki-sidebar .menu-list a {
		color: var(--color-text-secondary);
		padding: 0.5rem 0.75rem;
		border-radius: var(--radius-md);
		font-size: 0.9rem;
		transition: all 0.2s ease;
	}
	.wiki-sidebar .menu-list a:hover {
		background: var(--color-bg-secondary);
		color: var(--color-text-primary);
	}
	.wiki-sidebar .menu-list a.is-active {
		background: var(--color-primary);
		color: white;
	}
	.wiki-content-card {
		background: var(--color-bg-primary);
		border-radius: var(--radius-xl);
		box-shadow: var(--shadow-card);
		overflow: hidden;
	}
	.wiki-content-header {
		padding: 1.5rem;
		border-bottom: 1px solid var(--color-border-light);
		display: flex;
		justify-content: space-between;
		align-items: center;
		flex-wrap: wrap;
		gap: 1rem;
	}
	.wiki-content-title {
		font-size: 1.75rem;
		font-weight: 700;
		color: var(--color-text-primary);
		margin: 0;
	}
	.wiki-content-actions {
		display: flex;
		gap: 0.5rem;
		flex-wrap: wrap;
	}
	.wiki-content-actions .button {
		border-radius: var(--radius-md);
	}
	.wiki-content-body {
		padding: 2rem;
	}
	.wiki-content-body.content h1,
	.wiki-content-body.content h2,
	.wiki-content-body.content h3 {
		color: var(--color-text-primary);
		margin-top: 2rem;
		margin-bottom: 1rem;
		scroll-margin-top: 1rem;
	}
	.wiki-content-body.content h1:first-child,
	.wiki-content-body.content h2:first-child {
		margin-top: 0;
	}
	.wiki-content-body.content p {
		line-height: 1.7;
		margin-bottom: 1rem;
	}
	.wiki-content-body.content code {
		background: var(--color-bg-secondary);
		padding: 0.2rem 0.5rem;
		border-radius: var(--radius-sm);
		font-size: 0.9em;
	}
	.wiki-content-body.content pre {
		background: var(--color-bg-secondary);
		padding: 1rem;
		border-radius: var(--radius-md);
		overflow-x: auto;
	}
	.wiki-content-body.content table {
		width: 100%;
		border-collapse: collapse;
		margin: 1rem 0;
	}
	.wiki-content-body.content th,
	.wiki-content-body.content td {
		padding: 0.75rem;
		border: 1px solid var(--color-border-light);
		text-align: left;
	}
	.wiki-content-body.content th {
		background: var(--color-bg-secondary);
		font-weight: 600;
	}
	.wiki-reactions {
		display: flex;
		align-items: center;
		gap: 0.5rem;
	}
	.wiki-reactions .button {
		border-radius: var(--radius-md);
	}
	.wiki-new-page-btn {
		width: 100%;
		margin-bottom: 1rem;
		border-radius: var(--radius-md);
	}
	</style>
</head>
<body>
	<header id="header" class="hero is-primary is-bold is-modern" role="banner">
		<div class="hero-head">
			<%- include('../partials/header') %>
		</div>
		<div class="hero-body">
			<div class="container">
				<div class="has-text-centered fade-in">
					<h1 class="title is-2" style="color: white; margin-bottom: 0.5rem;">
						<span class="icon is-medium" style="margin-right: 0.5rem;">
							<i class="fa fa-book"></i>
						</span>
						<% if (pageData.mode === "page" && pageData.content) { %>
							<%= pageData.title.replace(/-/g, ' ') %>
						<% } else { %>
							Documentation
						<% } %>
					</h1>
					<p class="subtitle is-5" style="color: rgba(255,255,255,0.8); max-width: 550px; margin: 0 auto;">
						<% if (pageData.mode === "page" && pageData.content) { %>
							Skynet Wiki
						<% } else { %>
							Comprehensive guides, tutorials, and references for Skynet
						<% } %>
					</p>
					<%- include("../partials/adspace", { officialMode: typeof officialMode !== undefined ? officialMode : false, adsEnabled: true }) %>
					<% if (pageData.mode !== "edit") { %>
					<%- include('../partials/menu-toggle', { menuToggleButtonSize: "" }) %>
					<% } %>
				</div>
			</div>
		</div>
	</header>

	<main role="main">
		<section class="section" style="background: var(--color-bg-secondary); min-height: 60vh;">
			<div class="container">
				<div class="columns">
					<% if (pageData.mode !== "edit") { %>
					<div id="menu" class="column is-one-quarter">
						<div class="wiki-sidebar">
							<div class="wiki-search field has-addons">
								<div class="control is-expanded">
									<input id="search-input" class="input" type="text" placeholder="Search docs..." onkeydown="if (event.keyCode === 13) {SkynetUtil.searchWiki(this.value);}" value="<%= pageData.activeSearchQuery %>">
								</div>
								<div class="control">
									<a id="search-button" class="button is-primary" href="javascript:SkynetUtil.searchWiki(document.getElementById('search-input').value);">
										<span class="icon is-small">
											<i class="fa fa-search"></i>
										</span>
									</a>
								</div>
							</div>
							
							<% if (isContributor) { %>
							<a class="button is-primary is-modern wiki-new-page-btn" href="/wiki/new">
								<span class="icon"><i class="fa fa-plus"></i></span>
								<span>New Page</span>
							</a>
							<% } %>
							
							<span id="menu-spacer" class="is-hidden"><br></span>
							<aside class="menu">
								<span id="bookmarks-menu" class="is-hidden">
									<p class="menu-label">Bookmarks</p>
									<ul id="bookmarks-submenu" class="menu-list"></ul>
								</span>
								<% if (pageData.pageList.length > 0) { %>
									<% 
										const categories = {
											"General": ["Home", "Getting-Started", "FAQ", "Premium-Features"],
											"Commands": ["Commands", "Commands-Moderation", "Commands-Fun", "Commands-Utility", "Commands-Search", "Commands-Stats", "Commands-AI", "Commands-Economy"],
											"Guides": ["Server-Owner-Guide", "Admin-Levels", "AI-Guide", "Economy-Guide", "Music-Guide", "Ticket-System", "Developer-Tools"],
											"Extensions": ["Extensions", "Extension-Development"],
											"Other": []
										};
										
										pageData.pageList.forEach(page => {
											let found = false;
											for (const cat in categories) {
												if (categories[cat].includes(page)) {
													found = true;
													break;
												}
											}
											if (!found) categories["Other"].push(page);
										});
									%>

									<% for (const [category, pages] of Object.entries(categories)) { %>
										<% if (pages.length > 0) { %>
											<p class="menu-label"><%= category %></p>
											<ul class="menu-list">
												<% pages.forEach(pageListItem => { %>
													<li>
														<a id="menu-<%= pageListItem %>" class="<%= pageListItem === pageData.title ? 'is-active' : '' %>" href="/wiki/<%= pageListItem %>">
															<%= pageListItem.replace(/-/g, ' ') %>
														</a>
													</li>
												<% }); %>
											</ul>
										<% } %>
									<% } %>
								<% } %>
								<% if (pageData.mode === "page" && pageData.content) { %>
									<p class="menu-label">On This Page</p>
									<ul id="submenu" class="menu-list"></ul>
								<% } %>
							</aside>
						</div>
					</div>
					<% } %>
					
					<div class="column">
						<div class="wiki-content-card">
							<div class="wiki-content-header">
								<h1 id="page-title" class="wiki-content-title">
									<%= pageData.title ? pageData.title.replace(/-/g, ' ') : 'Wiki' %>
								</h1>
								<% if (pageData.mode === "page" && pageData.content) { %>
								<script>
								function addReaction(value) {
									$.ajax({
										type: "POST",
										url: "/wiki/<%= pageData.title %>/react?value=" + value,
										success: function() {
											Turbolinks.visit("");
										}
									});
								}
								</script>
								<div class="wiki-content-actions">
									<div class="wiki-reactions field has-addons">
										<p class="control">
											<a class="button <%= (authUser && pageData.userReaction.value === -1) ? 'is-dark' : 'is-light' %>" onclick="addReaction(-1);" title="Not helpful"<%= !authUser ? ' disabled' : '' %>>
												<span class="icon is-small"><i class="fa fa-thumbs-down"></i></span>
												<span><%= pageData.reactions[-1] %></span>
											</a>
										</p>
										<p class="control">
											<a class="button <%= (authUser && pageData.userReaction.value === 1) ? 'is-dark' : 'is-light' %>" onclick="addReaction(1);" title="Helpful"<%= !authUser ? ' disabled' : '' %>>
												<span class="icon is-small"><i class="fa fa-thumbs-up"></i></span>
												<span><%= pageData.reactions[1] %></span>
											</a>
										</p>
									</div>
									<a class="button is-light" href="/wiki/<%= pageData.title %>/history">
										<span class="icon is-small"><i class="fa fa-history"></i></span>
										<span>History</span>
									</a>
									<% if (isContributor) { %>
									<a class="button is-info" href="/wiki/<%= pageData.title %>/edit">
										<span class="icon is-small"><i class="fa fa-pencil"></i></span>
										<span>Edit</span>
									</a>
									<script>
									function deletePage(id) {
										const prompt = confirm("Are you sure you want to delete this page?");
										if(prompt) {
											$.ajax({
												type: "POST",
												url: "/wiki/" + id + "/delete",
												success: function() {
													Turbolinks.visit("/wiki");
												}
											});
										}
									}
									</script>
									<a class="button is-danger is-outlined" onclick="deletePage('<%= pageData.title %>');">
										<span class="icon is-small"><i class="fa fa-trash"></i></span>
									</a>
									<% } %>
								</div>
								<% } %>
							</div>
							<div id="frame" class="wiki-content-body <%= (pageData.mode === 'page' && pageData.content) ? 'content' : '' %>">
								<% if (pageData.mode === "search") { %>
									<%- include('../partials/wiki-search-results') %>
								<% } else if (["page", "history"].includes(pageData.mode)) { %>
									<% if (pageData.mode === "page" && pageData.content) { %>
										<%- pageData.content %>
									<% } else if (pageData.mode === "history" && pageData.updates) { %>
										<%- include('../partials/wiki-edit-history') %>
									<% } else { %>
										<div class="has-text-centered" style="padding: 3rem;">
											<span class="icon is-large" style="color: var(--color-text-muted);">
												<i class="fa fa-file-text-o fa-3x"></i>
											</span>
											<h3 class="title is-5" style="margin-top: 1rem;">Page Not Found</h3>
											<p class="has-text-grey">This wiki page doesn't exist yet.</p>
											<% if (isContributor) { %>
											<a href="/wiki/new" class="button is-primary is-modern" style="margin-top: 1rem;">
												<span class="icon"><i class="fa fa-plus"></i></span>
												<span>Create This Page</span>
											</a>
											<% } %>
										</div>
									<% } %>
								<% } else if (pageData.mode === "edit") { %>
									<%- include('../partials/wiki-editor') %>
								<% } %>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</main>

	<% if (pageData.mode === "page" && pageData.content) { %>
	<script>
	SkynetUtil.populateWikiSections();
	</script>
	<% } %>

	<%- include('../partials/footer') %>
	<%- include('../partials/scroll-top-button') %>
</body>
</html>
