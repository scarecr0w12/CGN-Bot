<!DOCTYPE html>
<html lang="en">
<head>
	<title>Skynet Dashboard</title>
	<%- include("../partials/head") %>

	<script>
	var mq = window.matchMedia("screen and (max-width: 768px)");
	mq.addListener(mediaStyle);
	function mediaStyle() {
		if(mq.matches) {
			$(".server-icon").removeClass("is-48x48");
			$(".server-icon").addClass("is-32x32");
			$(".server-name").removeClass("is-2");
			$(".server-name").addClass("is-3");
			$(".server-arrow").removeClass("is-large");
			$(".server-arrow").addClass("is-medium");
		} else {
			$(".server-icon").removeClass("is-32x32");
			$(".server-icon").addClass("is-48x48");
			$(".server-name").removeClass("is-3");
			$(".server-name").addClass("is-2");
			$(".server-arrow").removeClass("is-medium");
			$(".server-arrow").addClass("is-large");
		}
	}
	</script>
</head>
<body onload="mediaStyle();">
	<section id="header" class="main-header-section hero is-primary is-fullheight is-bold">
		<div class="hero-head">
			<%- include("../partials/header") %>
		</div>
		<div class="hero-body">
			<div class="container">
				<div class="has-text-centered" style="margin-bottom: 2rem;">
					<div class="hero-floating" style="margin-bottom: 1.5rem;">
						<img src="<%= authUser.avatar %>" alt="<%= authUser.username %>" style="width: 80px; height: 80px; border-radius: 50%; border: 4px solid rgba(255,255,255,0.3); box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
					</div>
					<h1 class="title is-2" style="font-weight: 700;">
						Welcome back, <strong><%= authUser.username %></strong>!
					</h1>
					<p class="subtitle is-5" style="opacity: 0.9;">
						<% if (serverData.length > 0) { %>
							Select a server to manage
						<% } else { %>
							<span>You don't have any guilds yet</span>
							<span class="icon">
								<i class="fa fa-meh-o"></i>
							</span>
						<% } %>
					</p>
				</div>
				<div class="columns is-centered">
					<div class="column is-8 is-10-tablet">
						<% serverData.forEach((server, index) => { %>
							<% if (!server.botJoined) { %>
								<a class="server-card modal-button" data-target="#post-add-modal" target="_blank" href="<%= pageData.rawJoinLink + '&guild_id=' + server.id %>" style="animation-delay: <%= index * 0.05 %>s;">
							<% } else if (!server.isAdmin) { %>
								<a class="server-card modal-button" data-target="#not-admin-modal" style="opacity: 0.6; animation-delay: <%= index * 0.05 %>s;">
							<% } else { %>
								<a class="server-card" href="/dashboard/<%= server.id %>/<%= server.id === 'maintainer' ? 'maintainer' : 'overview'%>" style="animation-delay: <%= index * 0.05 %>s;">
							<% } %>
								<img src="<%= server.icon %>" alt="<%= server.id %>" class="server-icon" style="width: 56px; height: 56px; border-radius: 12px; margin-right: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
								<div style="flex: 1;">
									<h2 style="font-size: 1.25rem; font-weight: 600; color: white; margin-bottom: 0.25rem;"><%= server.name %></h2>
									<p style="font-size: 0.875rem; color: rgba(255,255,255,0.6);">
										<% if (!server.botJoined) { %>
											<span class="icon is-small"><i class="fa fa-plus-circle"></i></span> Add Skynet
										<% } else if (!server.isAdmin) { %>
											<span class="icon is-small"><i class="fa fa-lock"></i></span> No admin access
										<% } else { %>
											<span class="icon is-small"><i class="fa fa-cog"></i></span> Manage server
										<% } %>
									</p>
								</div>
								<% if (server.botJoined && server.isAdmin) { %>
									<span class="server-arrow" style="color: rgba(255,255,255,0.4); transition: all 0.2s;">
										<i class="fa fa-chevron-right fa-lg"></i>
									</span>
								<% } else if (!server.botJoined) { %>
									<span style="background: #14b8a6; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
										Add Bot
									</span>
								<% } %>
							</a>
						<% }); %>
						
						<% if (serverData.length === 0) { %>
							<div style="text-align: center; padding: 3rem; background: rgba(255,255,255,0.1); border-radius: 16px; border: 2px dashed rgba(255,255,255,0.2);">
								<span class="icon is-large" style="color: rgba(255,255,255,0.3); margin-bottom: 1rem;">
									<i class="fa fa-server fa-3x"></i>
								</span>
								<p style="color: rgba(255,255,255,0.7); margin-bottom: 1rem;">No servers found</p>
								<a class="button is-modern is-primary" href="/add">
									<span class="icon"><i class="fa fa-plus"></i></span>
									<span>Add Skynet to a Server</span>
								</a>
							</div>
						<% } %>
					</div>
				</div>
			</div>
		</div>
		<div class="hero-foot">
			<div class="container has-text-centered">
				<a class="button is-white is-outlined" href="/login">
                    <span class="icon">
                        <i class="fa fa-refresh"></i>
                    </span>
                    <span>Refresh</span>
                </a>
                &nbsp;
				<a class="button is-white is-outlined" target="_blank" href="/wiki/Configuration">
                    <span class="icon">
                        <i class="fa fa-question-circle"></i>
                    </span>
                    <span>Help</span>
                </a>
                &nbsp;
				<a class="button is-white is-outlined" href="/logout">
                    <span class="icon">
                        <i class="fa fa-sign-out"></i>
                    </span>
                    <span>Logout</span>
                </a>
                <br><br>
			</div>
		</div>
	</section>

	<div id="not-admin-modal" class="modal">
		<div class="modal-background"></div>
		<div class="modal-container">
			<div class="modal-content">
				<div class="box">
					<h4 class="title is-4">
						<strong>You do not have permission to access the admin console for that server.</strong> Ask the owner of the server or other moderators to give you access to the admin console (level 3 admin).
					</h4>
				</div>
			</div>
		</div>
		<button class="modal-close is-large"></button>
	</div>
	<div id="post-add-modal" class="modal">
		<div class="modal-background"></div>
		<div class="modal-container">
			<div class="modal-content">
				<div class="box">
					<h4 class="title is-4">
						Make sure to <strong><a href="/dashboard">refresh</a></strong> after adding Skynet.
					</h4>
				</div>
			</div>
		</div>
		<button class="modal-close is-large"></button>
	</div>

	<%- include("../partials/footer") %>
	<%- include("../partials/scroll-top-button") %>
</body>
</html>
