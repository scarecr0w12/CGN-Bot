<form id="form" onsubmit="return false;">
	<!-- Import Extension Modal -->
	<div id="import-extension-modal" class="modal">
		<div class="modal-background" onclick="document.getElementById('import-extension-modal').classList.remove('is-active');"></div>
		<div class="modal-card">
			<header class="modal-card-head">
				<p class="modal-card-title">Import Extension</p>
				<button class="delete" aria-label="close" onclick="document.getElementById('import-extension-modal').classList.remove('is-active');"></button>
			</header>
			<section class="modal-card-body">
				<div class="field">
					<label class="label">Upload Extension Package (.skypkg)</label>
					<div class="file has-name is-fullwidth">
						<label class="file-label">
							<input class="file-input" type="file" id="import-file-input" accept=".skypkg,.json" onchange="SkynetUtil.handleExtensionFileSelect(this);">
							<span class="file-cta">
								<span class="file-icon">
									<i class="fas fa-upload"></i>
								</span>
								<span class="file-label">Choose a file...</span>
							</span>
							<span class="file-name" id="import-file-name">No file selected</span>
						</label>
					</div>
					<p class="help">Select a .skypkg file exported from another Skynet instance</p>
				</div>
				<div id="import-preview" class="is-hidden">
					<hr>
					<h4 class="title is-5">Extension Preview</h4>
					<div id="import-preview-content"></div>
				</div>
				<div id="import-error" class="notification is-danger is-hidden"></div>
			</section>
			<footer class="modal-card-foot">
				<button id="import-submit-btn" class="button is-success" disabled onclick="SkynetUtil.submitExtensionImport();">
					<span class="icon"><i class="fas fa-download"></i></span>
					<span>Import</span>
				</button>
				<button class="button" onclick="document.getElementById('import-extension-modal').classList.remove('is-active');">Cancel</button>
			</footer>
		</div>
	</div>

	<% if (pageData.extensionEarnings) { %>
	<div class="box" style="margin-bottom: 1rem;">
		<h3 class="title is-5" style="margin-bottom: 0.75rem;">Earnings</h3>
		<div class="columns is-multiline">
			<div class="column is-one-third">
				<strong>Available</strong>
				<div><%= pageData.extensionEarnings.balance || 0 %> points</div>
			</div>
			<div class="column is-one-third">
				<strong>Lifetime earned</strong>
				<div><%= pageData.extensionEarnings.lifetime_earned || 0 %> points</div>
			</div>
			<div class="column is-one-third">
				<strong>Total withdrawn</strong>
				<div><%= pageData.extensionEarnings.total_withdrawn || 0 %> points</div>
			</div>
		</div>
		<div class="field has-addons" style="max-width: 420px;">
			<p class="control is-expanded">
				<input id="extension-withdraw-amount" class="input" type="number" min="1" placeholder="Amount to withdraw">
			</p>
			<p class="control">
				<button class="button is-primary" onclick="SkynetUtil.withdrawExtensionEarnings(); return false;">Withdraw to Vote Balance</button>
			</p>
		</div>
	</div>
	<% } %>

	<div style="overflow-x: scroll;">
		<% if (pageData.extensions.length > 0) { %>
			<table class="table is-fullwidth">
				<thead>
					<tr>
						<th>Name</th>
						<th>ID</th>
						<th>Latest Version</th>
						<th>Status</th>
						<th>Type</th>
						<th>Premium</th>
						<th>Price</th>
						<th>Purchases</th>
						<th>Revenue</th>
						<th>Points</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<% pageData.extensions.forEach(extension => { %>
						<tr>
							<td>
								<%= extension.name %>
							</td>
							<td>
								<%= extension._id %>
							</td>
							<td>
								V<%= extension.version %>
							</td>
							<td>
								<% if (extension.state === "gallery") { %>
								Published
								<% } else if (extension.state === "queue") { %>
								In Queue
								<% } else if (extension.state === "version_queue") { %>
								Version in Queue
								<% } else { %>
								Saved
								<% } %>
							</td>
							<td>
								<%= extension.versions.id(extension.version).type.charAt(0).toUpperCase() + extension.versions.id(extension.version).type.slice(1) %>
							</td>
							<td>
								<%= extension.premium && extension.premium.is_premium ? 'Yes' : 'No' %>
							</td>
							<td>
								<%= extension.premium && extension.premium.price_points ? extension.premium.price_points : 0 %>
							</td>
							<td>
								<%= extension.premium && extension.premium.purchases ? extension.premium.purchases : 0 %>
							</td>
							<td>
								<%= extension.premium && extension.premium.developer_earnings ? extension.premium.developer_earnings : 0 %>
							</td>
							<td>
								<%= extension.points %>
							</td>
							<td>
								<% if (extension.state !== "saved") { %>
								<a class="button is-small" href="/extensions/<%= extension.state === "version_queue" ? "queue" : extension.state %>?id=<%= extension._id %>">
									<span class="icon is-small">
										<i class="fas fa-eye"></i>
									</span>
									<span>View</span>
								</a>
								<% } else { %>
								<button id="publish-<%= extension._id %>" class="button is-small" onclick="SkynetUtil.publishExtension('<%= extension._id %>'); return false;">
									<span class="icon is-small">
										<i class="fas fa-share-alt"></i>
									</span>
									<span>Publish</span>
								</button>
								<% } %>
								<a class="button is-small is-primary" href="/extensions/builder?extid=<%= extension._id %>">
									<span class="icon is-small">
										<i class="fas fa-pen"></i>
									</span>
									<span>Edit</span>
								</a>
								<a class="button is-small is-info" href="/extensions/<%= extension._id %>/export" title="Export as portable package">
									<span class="icon is-small">
										<i class="fas fa-share-square-o"></i>
									</span>
									<span>Export</span>
								</a>
								<a class="button is-small is-link" href="/extensions/<%= extension._id %>/sales" target="_blank">
									<span class="icon is-small">
										<i class="fas fa-chart-line"></i>
									</span>
									<span>Sales</span>
								</a>
								<button id="delete-<%= extension._id %>" class="button is-small is-danger" onclick="SkynetUtil.deleteExtension('<%= extension._id %>'); return false;">
									<span>Delete</span>
									<span class="icon is-small">
										<i class="fas fa-trash-alt"></i>
									</span>
								</button>
							</td>
						</tr>
					<% }); %>
				</tbody>
			</table>
		<% } else { %>
			<article class="message">
				<div class="message-header">
					<p>
						<span class="icon">
							<i class="fas fa-meh-o"></i>
						</span>
						Nothing to see here
					</p>
				</div>
				<div class="message-body">
					You haven't published any extensions yet. Head over to the <a href="/extensions/builder">extension builder</a> to get started building one!
				</div>
			</article>
			<br>
		<% } %>
	</div>
	<br>
	<div class="field is-grouped">
		<p class="control">
			<a class="button" href="/extensions/builder">
				<span class="icon">
					<i class="fas fa-code"></i>
		    	</span>
		    	<span>Build an extension</span>
			</a>
		</p>
		<p class="control">
			<button class="button is-info" onclick="document.getElementById('import-extension-modal').classList.add('is-active');">
				<span class="icon">
					<i class="fas fa-upload"></i>
		    	</span>
		    	<span>Import Extension</span>
			</button>
		</p>
	</div>
</form>
