<style>
/* Extension Gallery Styles */
.ext-gallery-filters {
	background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
	border-radius: 12px;
	padding: 1.25rem;
	margin-bottom: 1.5rem;
	box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}
.ext-filter-row {
	display: flex;
	flex-wrap: wrap;
	gap: 1rem;
	align-items: center;
	justify-content: space-between;
}
.ext-category-pills {
	display: flex;
	flex-wrap: wrap;
	gap: 0.5rem;
}
.ext-category-pill {
	display: inline-flex;
	align-items: center;
	gap: 0.4rem;
	padding: 0.5rem 1rem;
	border-radius: 50px;
	font-size: 0.9rem;
	font-weight: 500;
	text-decoration: none;
	transition: all 0.2s ease;
	border: 2px solid transparent;
	background: rgba(255,255,255,0.08);
	color: rgba(255,255,255,0.7);
}
.ext-category-pill:hover {
	background: rgba(255,255,255,0.15);
	color: #fff;
	transform: translateY(-1px);
}
.ext-category-pill.is-active {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	color: #fff;
	border-color: transparent;
	box-shadow: 0 3px 10px rgba(102,126,234,0.4);
}
.ext-category-pill .pill-count {
	background: rgba(0,0,0,0.2);
	padding: 0.1rem 0.5rem;
	border-radius: 50px;
	font-size: 0.75rem;
}
.ext-sort-dropdown .select select {
	background: rgba(255,255,255,0.1);
	border: 1px solid rgba(255,255,255,0.2);
	color: #fff;
	border-radius: 8px;
	padding-right: 2.5rem;
}
.ext-sort-dropdown .select::after {
	border-color: #fff !important;
}
.ext-sort-dropdown .select select:hover {
	border-color: rgba(255,255,255,0.4);
}
.ext-sort-dropdown label {
	color: rgba(255,255,255,0.7);
	font-size: 0.85rem;
	margin-right: 0.5rem;
}

.ext-badge-premium {
	background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
	color: #fff;
}
.ext-badge-owned {
	background: linear-gradient(135deg, #10b981 0%, #059669 100%);
	color: #fff;
}

/* Card Grid */
.ext-card-grid {
	display: grid;
	grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
	gap: 1.5rem;
}
.ext-card {
	background: #fff;
	border-radius: 12px;
	overflow: hidden;
	box-shadow: 0 2px 15px rgba(0,0,0,0.08);
	transition: all 0.3s ease;
	display: flex;
	flex-direction: column;
	border: 1px solid #eee;
}
.ext-card:hover {
	transform: translateY(-4px);
	box-shadow: 0 8px 30px rgba(0,0,0,0.12);
}
.ext-card-header {
	padding: 1.25rem 1.25rem 0.75rem;
	display: flex;
	justify-content: space-between;
	align-items: flex-start;
	gap: 0.75rem;
}
.ext-card-title {
	font-size: 1.15rem;
	font-weight: 600;
	color: #1a1a2e;
	margin: 0;
	line-height: 1.3;
}
.ext-card-badges {
	display: flex;
	gap: 0.4rem;
	flex-wrap: wrap;
	margin-top: 0.5rem;
}
.ext-badge {
	display: inline-flex;
	align-items: center;
	gap: 0.25rem;
	padding: 0.2rem 0.6rem;
	border-radius: 4px;
	font-size: 0.7rem;
	font-weight: 600;
	text-transform: uppercase;
	letter-spacing: 0.3px;
}
.ext-badge-featured {
	background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
	color: #fff;
}
.ext-badge-type {
	background: #e8eaf6;
	color: #3949ab;
}
.ext-badge-type.command { background: #e3f2fd; color: #1565c0; }
.ext-badge-type.keyword { background: #fff3e0; color: #ef6c00; }
.ext-badge-type.timer { background: #f3e5f5; color: #7b1fa2; }
.ext-badge-type.event { background: #e8f5e9; color: #2e7d32; }
.ext-badge-version {
	background: #f5f5f5;
	color: #666;
}
.ext-card-type-icon {
	width: 38px;
	height: 38px;
	border-radius: 10px;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 1rem;
	flex-shrink: 0;
}
.ext-card-type-icon.command { background: #e3f2fd; color: #1565c0; }
.ext-card-type-icon.keyword { background: #fff3e0; color: #ef6c00; }
.ext-card-type-icon.timer { background: #f3e5f5; color: #7b1fa2; }
.ext-card-type-icon.event { background: #e8f5e9; color: #2e7d32; }

.ext-card-body {
	padding: 0 1.25rem 1rem;
	flex-grow: 1;
}
.ext-card-description {
	color: #666;
	font-size: 0.9rem;
	line-height: 1.5;
	margin: 0;
	display: -webkit-box;
	-webkit-line-clamp: 3;
	line-clamp: 3;
	-webkit-box-orient: vertical;
	overflow: hidden;
}
.ext-card-meta {
	display: flex;
	align-items: center;
	gap: 0.75rem;
	padding: 0.75rem 1.25rem;
	background: #fafafa;
	border-top: 1px solid #eee;
}
.ext-card-author {
	display: flex;
	align-items: center;
	gap: 0.5rem;
	flex-grow: 1;
	min-width: 0;
}
.ext-card-author img {
	width: 28px;
	height: 28px;
	border-radius: 50%;
	object-fit: cover;
}
.ext-card-author-info {
	min-width: 0;
}
.ext-card-author-name {
	font-size: 0.8rem;
	font-weight: 500;
	color: #333;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}
.ext-card-updated {
	font-size: 0.7rem;
	color: #999;
}
.ext-card-points {
	display: flex;
	align-items: center;
	gap: 0.3rem;
	background: linear-gradient(135deg, #ffd54f 0%, #ffb300 100%);
	color: #5d4037;
	padding: 0.3rem 0.6rem;
	border-radius: 50px;
	font-size: 0.8rem;
	font-weight: 600;
	flex-shrink: 0;
}
.ext-card-footer {
	display: flex;
	border-top: 1px solid #eee;
}
.ext-card-action {
	flex: 1;
	padding: 0.75rem;
	text-align: center;
	font-size: 0.85rem;
	font-weight: 500;
	color: #667eea;
	text-decoration: none;
	transition: all 0.2s ease;
	cursor: pointer;
	background: none;
	border: none;
	border-right: 1px solid #eee;
}
.ext-card-action:last-child {
	border-right: none;
}
.ext-card-action:hover {
	background: #f5f7ff;
	color: #4c5fd5;
}
.ext-card-action.danger {
	color: #e53935;
}
.ext-card-action.danger:hover {
	background: #ffebee;
}
/* Empty state */
.ext-empty-state {
	text-align: center;
	padding: 4rem 2rem;
	background: #fafafa;
	border-radius: 12px;
	border: 2px dashed #ddd;
}
.ext-empty-icon {
	font-size: 3rem;
	color: #ccc;
	margin-bottom: 1rem;
}
.ext-empty-title {
	font-size: 1.25rem;
	font-weight: 600;
	color: #666;
	margin-bottom: 0.5rem;
}
.ext-empty-text {
	color: #999;
	margin-bottom: 1.5rem;
}

@media (max-width: 768px) {
	.ext-filter-row {
		flex-direction: column;
		align-items: stretch;
	}
	.ext-category-pills {
		justify-content: center;
	}
	.ext-sort-dropdown {
		justify-content: center;
		display: flex;
	}
	.ext-card-grid {
		grid-template-columns: 1fr;
	}
}
</style>

<div id="typeDescription-event" class="modal">
	<div class="modal-background"></div>
	<div class="modal-content">
		<div class="box">
			<br>
			<h1 class="title is-3 has-text-centered">
				<span class="icon is-large">
					<i class="fa fa-code fa-3x"></i>
				</span>
			</h1>
			<h3 class="subtitle is-3 has-text-centered">Event</h3>
			<br>
			Event extensions are executed when a specific event is emitted from Discord. This allows extensions to react to things happening in your server in real-time.
			<br>
			<br>
			For example, imagine an important channel is deleted; an extension configured to run on the channelDelete event could grab the channel data, check if the name matches a prior configured channel name, and then restore the channel.
		</div>
	</div>
	<button class="modal-close is-large"></button>
</div>
<div id="typeDescription-command" class="modal">
	<div class="modal-background"></div>
	<div class="modal-content">
		<div class="box">
			<br>
			<h1 class="title is-3 has-text-centered">
				<span class="icon is-large">
					<i class="fa fa-magic fa-3x"></i>
				</span>
			</h1>
			<h3 class="subtitle is-3 has-text-centered">Command</h3>
			<br>
			Command extensions function just like normal commands, and you have to use them with your configured Skynet Prefix.
			<br>
			<br>
			Command extensions are useful to add additional functionality to Skynet, for example in the form of fetching data from API's, or performing moderation actions within the Discord guild.
		</div>
	</div>
	<button class="modal-close is-large"></button>
</div>
<div id="typeDescription-keyword" class="modal">
	<div class="modal-background"></div>
	<div class="modal-content">
		<div class="box">
			<br>
			<h1 class="title is-3 has-text-centered">
				<span class="icon is-large">
					<i class="fa fa-key fa-3x"></i>
				</span>
			</h1>
			<h3 class="subtitle is-3 has-text-centered">Keyword</h3>
			<br>
			If you ever need Skynet to respond to certain messages, or make custom advanced filters, keyword extensions are your friend.
			<br>
			<br>
			Keyword extensions are executed when a message sent by a user contains one of a pre-configured set of keywords.
		</div>
	</div>
	<button class="modal-close is-large"></button>
</div>
<div id="typeDescription-timer" class="modal">
	<div class="modal-background"></div>
	<div class="modal-content">
		<div class="box">
			<br>
			<h1 class="title is-3 has-text-centered">
				<span class="icon is-large">
					<i class="fa fa-clock-o fa-3x"></i>
				</span>
			</h1>
			<h3 class="subtitle is-3 has-text-centered">Timer</h3>
			<br>
			Timer extensions are run on a configured interval, which makes them extremely useful for various purposes.
			<br>
			<br>
			These extensions can, for example, poll an API on the configured interval and send the result to Discord, this allows you to connect any web application that responds to REST requests to Skynet
			<br>
			<br>
			If you plan to use this type of extension to respond to things happening in Discord, we recommend using <code>event</code> extensions instead.
		</div>
	</div>
	<button class="modal-close is-large"></button>
</div>

<div id="extensions-gallery">
	<%
	const categoryFilter = pageData.categoryFilter || 'all';
	const premiumFilter = pageData.premiumFilter || 'all';
	const sortOption = pageData.sortOption || 'featured';
	const categoryCounts = pageData.categoryCounts || { all: 0, command: 0, keyword: 0, timer: 0, event: 0 };
	const premiumCounts = pageData.premiumCounts || { all: 0, free: 0, premium: 0 };
	
	const buildFilterUrl = (category, sort, premium, tag) => {
		const params = new URLSearchParams();
		if (pageData.activeSearchQuery) params.set('q', pageData.activeSearchQuery);
		if (category && category !== 'all') params.set('category', category);
		if (premium && premium !== 'all') params.set('premium', premium);
		if (sort && sort !== 'featured') params.set('sort', sort);
		
		const targetTag = tag !== undefined ? tag : (pageData.tagFilter || 'all');
		if (targetTag && targetTag !== 'all') params.set('tag', targetTag);

		const queryString = params.toString();
		return `/extensions/${pageData.mode}${queryString ? '?' + queryString : ''}`;
	};
	
	const typeIcons = { command: 'magic', keyword: 'key', timer: 'clock-o', event: 'code' };
	const typeLabels = { command: 'Commands', keyword: 'Keywords', timer: 'Timers', event: 'Events' };
	%>

	<!-- Filters and Sorting -->
	<div class="ext-gallery-filters">
		<div class="ext-filter-row">
			<div class="ext-category-pills">
				<a href="<%= buildFilterUrl('all', sortOption, premiumFilter) %>" class="ext-category-pill <%= categoryFilter === 'all' ? 'is-active' : '' %>">
					<i class="fa fa-th-large"></i>
					All
					<span class="pill-count"><%= categoryCounts.all %></span>
				</a>
				<a href="<%= buildFilterUrl('command', sortOption, premiumFilter) %>" class="ext-category-pill <%= categoryFilter === 'command' ? 'is-active' : '' %>">
					<i class="fa fa-magic"></i>
					Commands
					<span class="pill-count"><%= categoryCounts.command %></span>
				</a>
				<a href="<%= buildFilterUrl('keyword', sortOption, premiumFilter) %>" class="ext-category-pill <%= categoryFilter === 'keyword' ? 'is-active' : '' %>">
					<i class="fa fa-key"></i>
					Keywords
					<span class="pill-count"><%= categoryCounts.keyword %></span>
				</a>
				<a href="<%= buildFilterUrl('timer', sortOption, premiumFilter) %>" class="ext-category-pill <%= categoryFilter === 'timer' ? 'is-active' : '' %>">
					<i class="fa fa-clock-o"></i>
					Timers
					<span class="pill-count"><%= categoryCounts.timer %></span>
				</a>
				<a href="<%= buildFilterUrl('event', sortOption, premiumFilter) %>" class="ext-category-pill <%= categoryFilter === 'event' ? 'is-active' : '' %>">
					<i class="fa fa-code"></i>
					Events
					<span class="pill-count"><%= categoryCounts.event %></span>
				</a>
			</div>
			<div class="ext-category-pills">
				<a href="<%= buildFilterUrl(categoryFilter, sortOption, 'all') %>" class="ext-category-pill <%= premiumFilter === 'all' ? 'is-active' : '' %>">
					All
					<span class="pill-count"><%= premiumCounts.all %></span>
				</a>
				<a href="<%= buildFilterUrl(categoryFilter, sortOption, 'free') %>" class="ext-category-pill <%= premiumFilter === 'free' ? 'is-active' : '' %>">
					Free
					<span class="pill-count"><%= premiumCounts.free %></span>
				</a>
				<a href="<%= buildFilterUrl(categoryFilter, sortOption, 'premium') %>" class="ext-category-pill <%= premiumFilter === 'premium' ? 'is-active' : '' %>">
					Premium
					<span class="pill-count"><%= premiumCounts.premium %></span>
				</a>
			</div>
			<div class="ext-sort-dropdown">
				<label><i class="fa fa-sort"></i> Sort:</label>
				<div class="select is-small">
					<select onchange="window.location.href = this.value">
						<option value="<%= buildFilterUrl(categoryFilter, 'featured', premiumFilter) %>" <%= sortOption === 'featured' ? 'selected' : '' %>>Featured</option>
						<option value="<%= buildFilterUrl(categoryFilter, 'popular', premiumFilter) %>" <%= sortOption === 'popular' ? 'selected' : '' %>>Most Popular</option>
						<option value="<%= buildFilterUrl(categoryFilter, 'newest', premiumFilter) %>" <%= sortOption === 'newest' ? 'selected' : '' %>>Newest</option>
						<option value="<%= buildFilterUrl(categoryFilter, 'oldest', premiumFilter) %>" <%= sortOption === 'oldest' ? 'selected' : '' %>>Oldest</option>
						<option value="<%= buildFilterUrl(categoryFilter, 'name', premiumFilter) %>" <%= sortOption === 'name' ? 'selected' : '' %>>Name (A-Z)</option>
					</select>
				</div>
			</div>
		</div>
		
		<!-- Tags Filter Row -->
		<% if (pageData.extensionTags && pageData.extensionTags.length > 0) { %>
		<div class="ext-filter-row" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
			<div class="ext-category-pills">
				<span style="color: rgba(255,255,255,0.5); font-size: 0.85rem; font-weight: 600; margin-right: 0.5rem; display: flex; align-items: center;">
					<i class="fa fa-tags mr-1"></i> Tags:
				</span>
				<a href="<%= buildFilterUrl(categoryFilter, sortOption, premiumFilter, 'all') %>" class="ext-category-pill <%= !pageData.tagFilter || pageData.tagFilter === 'all' ? 'is-active' : '' %>" style="padding: 0.3rem 0.8rem; font-size: 0.85rem;">
					All
				</a>
				<% pageData.extensionTags.forEach(tag => { %>
				<a href="<%= buildFilterUrl(categoryFilter, sortOption, premiumFilter, tag) %>" class="ext-category-pill <%= pageData.tagFilter === tag ? 'is-active' : '' %>" style="padding: 0.3rem 0.8rem; font-size: 0.85rem;">
					<%= tag %>
					<% if (pageData.tagCounts && pageData.tagCounts[tag] > 0) { %>
					<span class="pill-count"><%= pageData.tagCounts[tag] %></span>
					<% } %>
				</a>
				<% }); %>
			</div>
		</div>
		<% } %>
	</div>
	<% if (pageData.mode === "queue") { %>
	<article class="message is-danger" title="Even Speedwagon is afraid!" style="margin-bottom: 1.5rem;">
		<div class="message-body">
			<div class="has-text-centered">
				<h5 class="title is-5 is-danger-colored">
					<span class="icon">
						<i class="fa fa-exclamation-triangle"></i>
					</span>
					Stay safe!
					<span class="icon">
						<i class="fa fa-exclamation-triangle"></i>
					</span>
				</h5>
			</div>
			<div class="content">
				Extensions in the <strong>Gallery Queue</strong> have not been tested or approved by <strong>Skynet Maintainers</strong>. Extensions from the queue may cause harm to your server or contain offensive or otherwise dangerous content. Skynet Maintainers are not responsible for any actions taken by unapproved extensions. <strong>You're on your own, kid.</strong>
			</div>
		</div>
	</article>
	<% } %>

	<% if (pageData.extensions.length > 0) { %>
	<!-- Extension Card Grid -->
	<div class="ext-card-grid">
		<% pageData.extensions.forEach((extension) => { %>
		<div id="card-<%= extension._id %>" class="ext-card">
			<div class="ext-card-header">
				<div>
					<h3 class="ext-card-title"><%= extension.name %></h3>
					<div class="ext-card-badges">
						<% if (extension.featured) { %>
						<span id="featured-<%= extension._id %>" class="ext-badge ext-badge-featured">
							<i class="fa fa-star"></i> Featured
						</span>
						<% } %>
						<% if (extension.isPremium) { %>
						<span class="ext-badge ext-badge-premium">
							<i class="fa fa-lock"></i> Premium <%= extension.premium && extension.premium.price_points ? (extension.premium.price_points + 'pts') : '' %>
						</span>
						<% } %>
						<% if (extension.hasPurchased) { %>
						<span class="ext-badge ext-badge-owned">
							<i class="fa fa-check"></i> Purchased
						</span>
						<% } %>
						<span class="ext-badge ext-badge-type <%= extension.type %>" title="<%= extension.typeDescription %>">
							<i class="fa fa-<%= extension.typeIcon %>"></i> <%= extension.type %>
						</span>
						<% if (extension.version !== 1) { %>
						<span class="ext-badge ext-badge-version">v<%= extension.version %></span>
						<% } %>
						<% if (extension.level === "third") { %>
						<span class="ext-badge" style="background:#ffebee;color:#c62828;">Local</span>
						<% } %>
						<% if (extension.network_capability && extension.network_capability !== 'none') { %>
						<% const needsApproval = ['network', 'network_advanced'].includes(extension.network_capability); %>
						<span class="ext-badge" style="background:<%= extension.network_approved ? '#e8f5e9' : (needsApproval ? '#ffebee' : '#fff3e0') %>;color:<%= extension.network_approved ? '#2e7d32' : (needsApproval ? '#c62828' : '#ef6c00') %>;" title="<%= extension.network_capability %><%= extension.network_approved && extension.network_approved_at ? ' - Approved ' + extension.network_approved_at : (needsApproval && !extension.network_approved ? ' - Pending Approval' : '') %>">
							<i class="fa fa-globe"></i> 
							<%= extension.network_capability === 'allowlist_only' ? 'Public APIs' : extension.network_capability === 'network' ? 'Network' : 'Advanced' %>
							<% if (extension.network_approved) { %><i class="fa fa-check ml-1"></i><% } else if (needsApproval) { %><i class="fa fa-clock-o ml-1"></i><% } %>
						</span>
						<% } %>
						<% if (extension.tags && extension.tags.length > 0) { %>
							<% extension.tags.forEach(tag => { %>
							<span class="ext-badge" style="background: #f5f5f5; color: #666; border: 1px solid #eee;">
								<i class="fa fa-tag" style="font-size: 0.6rem;"></i> <%= tag %>
							</span>
							<% }); %>
						<% } %>
					</div>
				</div>
				<div class="ext-card-type-icon <%= extension.type %>" title="<%= extension.typeDescription %>">
					<i class="fa fa-<%= extension.typeIcon %>"></i>
				</div>
			</div>
			<div class="ext-card-body">
				<p class="ext-card-description"><%- extension.description %></p>
			</div>
			<div class="ext-card-meta">
				<div class="ext-card-author">
					<img src="<%= extension.owner.avatar %>" alt="<%= extension.owner.name %>">
					<div class="ext-card-author-info">
						<div class="ext-card-author-name"><%= extension.owner.name %></div>
						<div class="ext-card-updated" title="<%= extension.rawLastUpdated %>"><%= extension.relativeLastUpdated %></div>
					</div>
				</div>
				<div class="ext-card-points" title="<%= extension.points %> points">
					<span id="points-<%= extension._id %>"><%= extension.points %></span>
					<i class="fa fa-star"></i>
				</div>
			</div>
			<div class="ext-card-footer">
				<% if (authUser && pageData.serverData && pageData.serverData.length > 0) { %>
				<a class="ext-card-action" data-extid="<%= extension._id %>" data-version="<%= extension.version %>" onclick="SkynetUtil.openExtensionInstaller(this.dataset.extid, parseInt(this.dataset.version, 10));">
					<i class="fa fa-download"></i> Install
				</a>
				<% } %>
				<a class="ext-card-action" onclick="SkynetUtil.loadSource('<%= extension._id %>', '<%= extension.version %>', '<%= extension.name %>')">
					<i class="fa fa-code"></i> Source
				</a>
				<% if (authUser) { %>
				<a id="vote-<%= extension._id %>" class="ext-card-action" onclick="SkynetUtil.voteExtension('<%= extension._id %>');">
					<i class="fa fa-thumbs-up"></i> <%= !pageData.upvotedData.includes(String(extension._id)) ? "+1" : "-1" %>
				</a>
				<% } %>
				<% if (authUser && isMaintainer) { %>
					<% if (pageData.mode === "gallery") { %>
					<a id="feature-<%= extension._id %>" class="ext-card-action" onclick="SkynetUtil.featureExtension('<%= extension._id %>');">
						<i class="fa fa-star"></i> <%= extension.featured ? "Unfeature" : "Feature" %>
					</a>
					<% if (extension.network_capability && ['network', 'network_advanced'].includes(extension.network_capability) && !extension.network_approved) { %>
					<a class="ext-card-action" style="color:#2e7d32;" onclick="SkynetUtil.approveNetworkCapability('<%= extension._id %>');">
						<i class="fa fa-globe"></i> Approve Network
					</a>
					<% } %>
					<% if (authUser.id !== extension.owner.id) { %>
					<a class="ext-card-action danger" onclick="SkynetUtil.removeExtension('<%= extension._id %>');">
						<i class="fa fa-trash"></i> Remove
					</a>
					<% } %>
					<% } %>
				<% } %>
				<% if (authUser && authUser.id === extension.owner.id && extension.level === "gallery") { %>
				<a class="ext-card-action danger" onclick="SkynetUtil.unpublishExtension('<%= extension._id %>');">
					<i class="fa fa-eye-slash"></i> Unpublish
				</a>
				<% } %>
			</div>
		</div>
		<% }); %>
	</div>
	<div id="extension-source-modal" class="modal">
		<div class="modal-background"></div>
		<div class="modal-content">
			<div class="box">
				<h4 class="is-4 title">Source Code for <b id="extension-source-name"></b></h4>
				<hr>
				<textarea id="extension-source-viewer"></textarea>
				<br>
                <a id="extension-source-download" class="button is-small">
			        <span class="icon is-small">
				        <i class="fa fa-download"></i>
			        </span>
                    <span>Download Code</span>
                </a>
				<a id="extension-source-export" class="button is-small is-info">
			        <span class="icon is-small">
				        <i class="fa fa-share-square-o"></i>
			        </span>
                    <span>Export Package</span>
                </a>
			</div>
		</div>
		<button class="modal-close"></button>
	</div>
<% } else { %>
	<!-- Empty State -->
	<div class="ext-empty-state">
		<div class="ext-empty-icon">
			<i class="fa fa-puzzle-piece"></i>
		</div>
		<h3 class="ext-empty-title">No extensions found</h3>
		<p class="ext-empty-text">
			<% if (pageData.activeSearchQuery) { %>
				No extensions match your search "<%= pageData.activeSearchQuery %>".
			<% } else if (categoryFilter !== 'all') { %>
				No <%= categoryFilter %> extensions available yet.
			<% } else { %>
				The gallery is empty. Be the first to publish an extension!
			<% } %>
		</p>
		<% if (pageData.activeSearchQuery || categoryFilter !== 'all') { %>
		<a href="/extensions/<%= pageData.mode %>" class="button is-primary">
			<span class="icon"><i class="fa fa-refresh"></i></span>
			<span>Clear Filters</span>
		</a>
		<% } else if (authUser) { %>
		<a href="/extensions/builder" class="button is-primary">
			<span class="icon"><i class="fa fa-plus"></i></span>
			<span>Create Extension</span>
		</a>
		<% } %>
	</div>
<% } %>
<% if (pageData.numPages > 1) { %>
	<%
	const buildPaginationUrl = (pageNum) => {
		const params = new URLSearchParams();
		if (pageData.activeSearchQuery) params.set('q', pageData.activeSearchQuery);
		if (categoryFilter && categoryFilter !== 'all') params.set('category', categoryFilter);
		if (sortOption && sortOption !== 'featured') params.set('sort', sortOption);
		if (pageData.tagFilter && pageData.tagFilter !== 'all') params.set('tag', pageData.tagFilter);
		if (pageData.itemsPerPage) params.set('count', pageData.itemsPerPage);
		params.set('page', pageNum);
		return `/extensions/${pageData.mode}?${params.toString()}`;
	};
	%>
	<br>
	<nav class="pagination is-centered" style="margin-top: 1.5rem;">
		<ul class="pagination-list">
			<% if (pageData.currentPage > 2) { %>
				<li>
					<a class="button pagination-link" href="<%= buildPaginationUrl(1) %>">1</a>
				</li>
			<% } %>
			<% if (pageData.currentPage > 3) { %>
				<li><span class="pagination-ellipsis">...</span></li>
			<% } %>
			<% if (pageData.currentPage > 1) { %>
				<li>
					<a class="button pagination-link" href="<%= buildPaginationUrl(pageData.currentPage - 1) %>">
						<%= pageData.currentPage - 1 %>
					</a>
				</li>
			<% } %>
			<li>
				<a class="button is-primary pagination-link" href="<%= buildPaginationUrl(pageData.currentPage) %>">
					<%= pageData.currentPage %>
				</a>
			</li>
			<% if (pageData.currentPage < pageData.numPages) { %>
				<li>
					<a class="button pagination-link" href="<%= buildPaginationUrl(pageData.currentPage + 1) %>">
						<%= pageData.currentPage + 1 %>
					</a>
				</li>
			<% } %>
			<% if (pageData.currentPage < pageData.numPages - 2) { %>
				<li><span class="pagination-ellipsis">...</span></li>
			<% } %>
			<% if (pageData.currentPage < pageData.numPages - 1) { %>
				<li>
					<a class="button pagination-link" href="<%= buildPaginationUrl(pageData.numPages) %>">
						<%= pageData.numPages %>
					</a>
				</li>
			<% } %>
		</ul>
	</nav>
<% } %>
</div>
