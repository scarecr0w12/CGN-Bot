<%
const isActive = (path) => currentPage === path;
const basePath = '/dashboard/maintainer';

const menuItem = (path, label, icon = null) => {
	const fullPath = `${basePath}/${path}`;
	const active = isActive(fullPath);
	const iconHtml = icon ? `<span class="icon is-small"><i class="${icon}"></i></span> ` : '';
	return active 
		? `<a class="is-active" href="#">${iconHtml}${label}</a>`
		: `<a href="${fullPath}">${iconHtml}${label}</a>`;
};

const serversPaths = ['servers/server-list', 'servers/big-message'];
const globalPaths = ['global-options/blocklist', 'global-options/bot-user', 'global-options/homepage', 'global-options/wiki-contributors', 'global-options/donations', 'global-options/vote-sites', 'global-options/bot-lists', 'global-options/premium-extensions', 'global-options/network-approvals', 'global-options/extension-queue', 'global-options/featured-creators'];
const membershipPaths = ['membership/features', 'membership/tiers', 'membership/oauth', 'membership/payments', 'membership/email', 'membership/servers'];
const managementPaths = ['management/maintainers', 'management/shards', 'management/injection', 'management/version', 'management/eval', 'management/logs'];
const infraPaths = ['infrastructure/cloudflare', 'infrastructure/indexnow'];

const isInSection = (paths) => paths.some(p => isActive(`${basePath}/${p}`));
%>
<aside class="menu">
	<ul class="menu-list">
		<li>
			<%- menuItem('maintainer', 'Overview') %>
			<%- menuItem('tickets', 'Support Tickets', 'fa fa-ticket') %>
			<%- menuItem('feedback', 'Feedback', 'fa fa-comments') %>
		</li>
	</ul>

	<div class="menu-section<%= isInSection(serversPaths) ? ' has-active' : '' %>" data-section="servers">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="fas fa-server"></i></span>
				<span>Servers</span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<%- menuItem('servers/server-list', 'Server List') %>
					<%- menuItem('servers/big-message', 'BigMessage') %>
				</li>
			</ul>
		</div>
	</div>

	<% if (accessPrivileges.includes("administration")) { %>
	<div class="menu-section<%= isInSection(globalPaths) ? ' has-active' : '' %>" data-section="global">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="fas fa-cogs"></i></span>
				<span>Global Options</span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<%- menuItem('global-options/blocklist', 'Blocklist') %>
					<%- menuItem('global-options/bot-user', 'Bot User') %>
					<%- menuItem('global-options/homepage', 'Homepage') %>
					<%- menuItem('global-options/wiki-contributors', 'Wiki Contributors') %>
					<% if (isSudoMaintainer) { %>
					<%- menuItem('global-options/donations', 'Donations') %>
					<%- menuItem('global-options/vote-sites', 'Vote Sites') %>
					<%- menuItem('global-options/bot-lists', 'Bot List APIs') %>
					<%- menuItem('global-options/premium-extensions', 'Premium Extensions') %>
					<%- menuItem('global-options/network-approvals', 'Network Approvals') %>
					<%- menuItem('global-options/extension-queue', 'Extension Queue') %>
					<%- menuItem('global-options/featured-creators', 'Featured Creators') %>
					<% } %>
				</li>
			</ul>
		</div>
	</div>
	<% } %>

	<% if (isSudoMaintainer && accessPrivileges.includes("administration")) { %>
	<div class="menu-section<%= isInSection(membershipPaths) ? ' has-active' : '' %>" data-section="membership">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="fas fa-id-card"></i></span>
				<span>Membership</span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<%- menuItem('membership/features', 'Features') %>
					<%- menuItem('membership/tiers', 'Tiers') %>
					<%- menuItem('membership/oauth', 'OAuth Providers') %>
					<%- menuItem('membership/payments', 'Payment Providers') %>
					<%- menuItem('membership/email', 'Email Settings') %>
					<%- menuItem('membership/servers', 'Server Management') %>
				</li>
			</ul>
		</div>
	</div>
	<% } %>

	<% if (accessPrivileges.includes("management")) { %>
	<div class="menu-section<%= isInSection(managementPaths) ? ' has-active' : '' %>" data-section="management">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="fas fa-wrench"></i></span>
				<span>Management</span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<%- menuItem('management/maintainers', 'Maintainers') %>
					<%- menuItem('management/shards', 'Shards') %>
					<%- menuItem('management/injection', 'Script Injection') %>
					<%- menuItem('management/version', 'Skynet Version') %>
					<% if (accessPrivileges.includes("eval")) { %>
					<%- menuItem('management/eval', 'Evaluate') %>
					<% } %>
					<%- menuItem('management/logs', 'Logs') %>
				</li>
			</ul>
		</div>
	</div>

	<div class="menu-section<%= isInSection(infraPaths) ? ' has-active' : '' %>" data-section="infra">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="fas fa-cloud"></i></span>
				<span>Infrastructure</span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<%- menuItem('infrastructure/cloudflare', 'Cloudflare') %>
					<%- menuItem('infrastructure/indexnow', 'IndexNow SEO') %>
				</li>
			</ul>
		</div>
	</div>
	<% } %>
</aside>
