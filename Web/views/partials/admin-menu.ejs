<%
const isActive = (path) => currentPage === path;
const basePath = `/dashboard/${serverData.id}`;

const menuSections = {
	commands: {
		icon: 'fa fa-cogs',
		label: 'Commands',
		paths: ['commands/command-options', 'commands/command-list', 'commands/rss-feeds', 'commands/game-updates', 'commands/streamers', 'commands/tags', 'commands/auto-translation', 'commands/trivia-sets', 'commands/api-keys', 'commands/tag-reaction']
	},
	stats: {
		icon: 'fa fa-star',
		label: 'Stats & Points',
		paths: ['stats-points/stats-collection', 'stats-points/ranks', 'stats-points/skynet-points', 'stats-points/economy', 'stats-points/economy-stats', 'stats-points/advanced-stats', 'stats-points/analytics']
	},
	admin: {
		icon: 'fa fa-wrench',
		label: 'Administration',
		paths: ['administration/admins', 'administration/moderation', 'administration/blocked', 'administration/muted', 'administration/strikes', 'administration/status-messages', 'administration/filters', 'administration/message-of-the-day', 'administration/voicetext-channels', 'administration/roles', 'administration/logs']
	},
	ai: {
		icon: 'fa fa-robot',
		label: 'AI Assistant',
		paths: ['ai/settings', 'ai/governance', 'ai/memory', 'ai/personality', 'ai/models']
	},
	extensions: {
		icon: 'fa fa-puzzle-piece',
		label: 'Extensions',
		paths: ['other/extensions', 'other/extension-builder']
	},
	serverProfile: {
		icon: 'fas fa-id-card',
		label: 'Server Profile',
		paths: ['server-profile', 'widgets']
	},
	subscription: {
		icon: 'fas fa-crown',
		label: 'Subscription',
		paths: ['subscription']
	},
	tickets: {
		icon: 'fas fa-ticket-alt',
		label: 'Tickets',
		paths: ['tickets', 'tickets/settings']
	},
	serverManagement: {
		icon: 'fas fa-server',
		label: 'Server Management',
		paths: ['server-management/channels', 'server-management/roles']
	}
};

const getSectionActive = (section) => section.paths.some(p => currentPage === `${basePath}/${p}`);

const menuItem = (path, label, icon = null) => {
	const fullPath = `${basePath}/${path}`;
	const active = isActive(fullPath);
	const iconHtml = icon ? `<span class="icon is-small"><i class="${icon}"></i></span> ` : '';
	return active 
		? `<a class="is-active" href="#">${iconHtml}${label}</a>`
		: `<a href="${fullPath}">${iconHtml}${label}</a>`;
};
%>
<aside class="menu">
	<ul class="menu-list">
		<li>
			<% if(isActive(`${basePath}/overview`)) { %>
				<%- include('../partials/admin-sudo.ejs') %>
				<a class="is-active" href="#">Overview</a>
			<% } else { %>
				<a href="<%= basePath %>/overview">Overview</a>
			<% } %>
		</li>
	</ul>

	<div class="menu-section<%= getSectionActive(menuSections.commands) ? ' has-active' : '' %>" data-section="commands">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="<%= menuSections.commands.icon %>"></i></span>
				<span><%= menuSections.commands.label %></span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<% if(isActive(`${basePath}/commands/command-options`)) { %>
					<%- include('../partials/admin-sudo.ejs') %>
					<% } %>
					<%- menuItem('commands/command-options', 'Command Options') %>

					<% const cmdListPages = ['commands/command-list', 'commands/rss-feeds', 'commands/game-updates', 'commands/streamers', 'commands/tags', 'commands/auto-translation', 'commands/trivia-sets'];
					   const onCmdListPage = cmdListPages.some(p => isActive(`${basePath}/${p}`)); %>
					<% if (onCmdListPage) { %>
					<%- include('../partials/admin-sudo.ejs') %>
					<a class="<%= isActive(`${basePath}/commands/command-list`) ? 'is-active' : '' %>" href="<%= isActive(`${basePath}/commands/command-list`) ? '#' : `${basePath}/commands/command-list` %>">Command List</a>
					<ul>
						<li><%- menuItem('commands/rss-feeds', 'RSS Feeds') %></li>
						<li><%- menuItem('commands/game-updates', 'Game Updates') %></li>
						<li><%- menuItem('commands/streamers', 'Streamers') %></li>
						<li><%- menuItem('commands/tags', 'Tags') %></li>
						<li><%- menuItem('commands/auto-translation', 'Auto Translation') %></li>
						<% if (configData.commands.trivia && configData.commands.trivia.isEnabled) { %>
						<li><%- menuItem('commands/trivia-sets', 'Trivia Sets') %></li>
						<% } %>
					</ul>
					<% } else { %>
					<a href="<%= basePath %>/commands/command-list">Command List &#9662;</a>
					<% } %>

					<% if(isActive(`${basePath}/commands/api-keys`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('commands/api-keys', 'API Keys') %>

					<% if(isActive(`${basePath}/commands/tag-reaction`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('commands/tag-reaction', 'Tag Reaction') %>
				</li>
			</ul>
		</div>
	</div>

	<div class="menu-section<%= getSectionActive(menuSections.stats) ? ' has-active' : '' %>" data-section="stats">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="<%= menuSections.stats.icon %>"></i></span>
				<span><%= menuSections.stats.label %></span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<% if(isActive(`${basePath}/stats-points/stats-collection`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('stats-points/stats-collection', 'Stats Collection') %>

					<% if(isActive(`${basePath}/stats-points/ranks`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('stats-points/ranks', 'Ranks') %>

					<% if(isActive(`${basePath}/stats-points/skynet-points`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('stats-points/skynet-points', 'SkynetPoints') %>

					<% if(isActive(`${basePath}/stats-points/economy`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('stats-points/economy', 'Economy', 'fas fa-coins') %>

					<% if(isActive(`${basePath}/stats-points/economy-stats`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('stats-points/economy-stats', 'Economy Stats', 'fas fa-chart-line') %>

					<% if(isActive(`${basePath}/stats-points/advanced-stats`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('stats-points/advanced-stats', 'Advanced Stats', 'fas fa-crown') %>

					<% if(isActive(`${basePath}/stats-points/analytics`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('stats-points/analytics', 'Analytics Dashboard', 'fas fa-chart-bar') %>
				</li>
			</ul>
		</div>
	</div>

	<div class="menu-section<%= getSectionActive(menuSections.admin) ? ' has-active' : '' %>" data-section="admin">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="<%= menuSections.admin.icon %>"></i></span>
				<span><%= menuSections.admin.label %></span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<% if(isActive(`${basePath}/administration/admins`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('administration/admins', 'Admins') %>

					<% const modPages = ['administration/moderation', 'administration/blocked', 'administration/muted', 'administration/strikes', 'administration/status-messages', 'administration/filters'];
					   const onModPage = modPages.some(p => isActive(`${basePath}/${p}`)); %>
					<% if (onModPage) { %>
					<%- include('../partials/admin-sudo.ejs') %>
					<a class="<%= isActive(`${basePath}/administration/moderation`) ? 'is-active' : '' %>" href="<%= isActive(`${basePath}/administration/moderation`) ? '#' : `${basePath}/administration/moderation` %>">Moderation</a>
					<ul>
						<li><%- menuItem('administration/blocked', 'Blocked') %></li>
						<li><%- menuItem('administration/muted', 'Muted') %></li>
						<li><%- menuItem('administration/strikes', 'Strikes') %></li>
						<li><a class="moderation-only-menu-item<%= isActive(`${basePath}/administration/status-messages`) ? ' is-active' : '' %><%= configData.moderation.isEnabled ? '' : ' is-hidden' %>" href="<%= isActive(`${basePath}/administration/status-messages`) ? '#' : `${basePath}/administration/status-messages` %>">Status Messages</a></li>
						<li><a class="moderation-only-menu-item<%= isActive(`${basePath}/administration/filters`) ? ' is-active' : '' %><%= configData.moderation.isEnabled ? '' : ' is-hidden' %>" href="<%= isActive(`${basePath}/administration/filters`) ? '#' : `${basePath}/administration/filters` %>">Filters</a></li>
						<li><a class="moderation-only-menu-item<%= isActive(`${basePath}/administration/filters`) ? ' is-active' : '' %><%= configData.moderation.isEnabled ? '' : ' is-hidden' %>" href="<%= isActive(`${basePath}/administration/filters`) ? '#' : `${basePath}/administration/filters#sentiment` %>"><span class="icon is-small"><i class="fas fa-brain"></i></span> Sentiment <span class="tag is-info is-small">Tier 1</span></a></li>
					</ul>
					<% } else { %>
					<a href="<%= basePath %>/administration/moderation">Moderation &#9662;</a>
					<% } %>

					<% if(isActive(`${basePath}/administration/message-of-the-day`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('administration/message-of-the-day', 'Message of the Day') %>

					<% if(isActive(`${basePath}/administration/voicetext-channels`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('administration/voicetext-channels', 'Voicetext Channels') %>

					<% if(isActive(`${basePath}/administration/roles`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('administration/roles', 'Roles') %>

					<% if(isActive(`${basePath}/administration/logs`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('administration/logs', 'Logs') %>
				</li>
			</ul>
		</div>
	</div>

	<div class="menu-section<%= getSectionActive(menuSections.ai) ? ' has-active' : '' %>" data-section="ai">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="<%= menuSections.ai.icon %>"></i></span>
				<span><%= menuSections.ai.label %></span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<% if(isActive(`${basePath}/ai/settings`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('ai/settings', 'AI Settings') %>

					<% if(isActive(`${basePath}/ai/governance`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('ai/governance', 'Governance & Usage') %>

					<% if(isActive(`${basePath}/ai/memory`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('ai/memory', 'Vector Memory') %>

					<% if(isActive(`${basePath}/ai/personality`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('ai/personality', 'AI Personality') %>

					<% if(isActive(`${basePath}/ai/models`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('ai/models', 'AI Models') %>
				</li>
			</ul>
		</div>
	</div>

	<div class="menu-section<%= getSectionActive(menuSections.extensions) ? ' has-active' : '' %>" data-section="extensions">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="<%= menuSections.extensions.icon %>"></i></span>
				<span><%= menuSections.extensions.label %></span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<% if(isActive(`${basePath}/other/extensions`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('other/extensions', 'Installed Extensions') %>

					<% if(isActive(`${basePath}/other/extension-builder`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('other/extension-builder', 'Extension Builder') %>
				</li>
			</ul>
		</div>
	</div>

	<div class="menu-section<%= getSectionActive(menuSections.serverProfile) ? ' has-active' : '' %>" data-section="serverProfile">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="<%= menuSections.serverProfile.icon %>"></i></span>
				<span><%= menuSections.serverProfile.label %></span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<% if(isActive(`${basePath}/server-profile`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('server-profile', 'Edit Profile') %>

					<% if(isActive(`${basePath}/widgets`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('widgets', 'Embeddable Widgets') %>
				</li>
			</ul>
		</div>
	</div>

	<div class="menu-section<%= getSectionActive(menuSections.subscription) ? ' has-active' : '' %>" data-section="subscription">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="<%= menuSections.subscription.icon %>"></i></span>
				<span><%= menuSections.subscription.label %></span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<% if(isActive(`${basePath}/subscription`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('subscription', 'Server Premium') %>
				</li>
			</ul>
		</div>
	</div>

	<div class="menu-section<%= getSectionActive(menuSections.tickets) ? ' has-active' : '' %>" data-section="tickets">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="<%= menuSections.tickets.icon %>"></i></span>
				<span><%= menuSections.tickets.label %></span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<% if(isActive(`${basePath}/tickets/settings`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('tickets/settings', 'Ticket Settings') %>

					<% if(isActive(`${basePath}/tickets`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('tickets', 'View Tickets') %>
				</li>
			</ul>
		</div>
	</div>

	<div class="menu-section<%= getSectionActive(menuSections.serverManagement) ? ' has-active' : '' %>" data-section="serverManagement">
		<div class="menu-section-header">
			<p class="menu-label">
				<span class="icon is-small"><i class="<%= menuSections.serverManagement.icon %>"></i></span>
				<span><%= menuSections.serverManagement.label %></span>
				<span class="tag is-warning is-small ml-2">Tier 2</span>
			</p>
			<span class="collapse-icon"><i class="fas fa-chevron-down"></i></span>
		</div>
		<div class="menu-section-content">
			<ul class="menu-list">
				<li>
					<% if(isActive(`${basePath}/server-management/channels`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('server-management/channels', 'Manage Channels', 'fas fa-hashtag') %>

					<% if(isActive(`${basePath}/server-management/roles`)) { %><%- include('../partials/admin-sudo.ejs') %><% } %>
					<%- menuItem('server-management/roles', 'Manage Roles', 'fas fa-users-cog') %>
				</li>
			</ul>
		</div>
	</div>
</aside>
